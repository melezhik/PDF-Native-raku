# set COVERAGE to enable coverage reporting

all: %DEST%/libpdf%SO%

SRCS = buf.c filt_predict.c filt_predict_png.c filt_predict_tiff.c read.c write.c
OBJS = buf%O% filt_predict%O% filt_predict_png%O% filt_predict_tiff%O% read%O% write%O% version%O%

%DEST%/libpdf%SO%: $(OBJS)
	%LD% %LDSHARED% %LDFLAGS% %LDOUT%%DEST%/libpdf%SO% $(OBJS) $(LD_COV_OPT)

buf%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ buf.c

filt_predict%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ filt_predict.c

filt_predict_png%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ filt_predict_png.c

filt_predict_tiff%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ filt_predict_tiff.c

read%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ read.c

write%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ write.c

version%O% :
	%CC% -I .. -c %CCSHARED% %CCFLAGS% $(CC_COV_OPT) %CCOUT%$@ version.c

coverage-reports : all
	gcov *.c

clean :
	@rm -f *%O% *.gc?? libpdf%SO% \
	&& rm -f %DEST%/libpdf.dll %DEST%/libpdf.dylib %DEST%/libpdf.so

realclean : clean
	@rm -f Makefile .depend

depend: .depend

.depend: $(SRCS)
	rm -f ./.depend
	%CC% -I .. %CCFLAGS% -MM $(SRCS) > ./.depend;

include .depend
